"use strict";(self.webpackChunkspa=self.webpackChunkspa||[]).push([[471],{9471:(Y,f,r)=>{r.r(f),r.d(f,{AccountModule:()=>D});var C=r(6276),b=r(7390),c=r(655),o=r(3075),l=r(7346);const A=[(0,l.d)([(0,l.u)({key:"firstName",label:"First Name",templateOptions:{required:!0}}),(0,l.u)({key:"lastName",label:"Last Name",templateOptions:{required:!0}}),(0,l.u)({key:"username",label:"UserName",templateOptions:{required:!0}}),(0,l.u)({key:"email",label:"Email",templateOptions:{required:!1,type:"email"}}),(0,l.u)({key:"website",label:"WebSite",templateOptions:{required:!1}})])];var y=r(5813),x=r(1135),S=r(6071),g=r(2340),e=r(5e3);let d=(()=>{class i{constructor(){this.userAuthChange$=new x.X({}),this.userAuthCurrentState=this.userAuthChange$.asObservable(),this.supabaseClient=(0,y.eI)(g.N.supabaseUrl,g.N.supabaseKey),this.supabaseClient.auth.onAuthStateChange((t,a)=>{console.log("auth changes ***",t,a),this.userAuthChange$.next({event:t,session:a})})}getSession(){return this.supabaseClient.auth.session()}get user(){return this.supabaseClient.auth.user()}get session(){return this.supabaseClient.auth.session()}get profile(){var t;return this.supabaseClient.from("profiles").select("username, firstName, lastName, website, avatar_url").eq("id",null===(t=this.user)||void 0===t?void 0:t.id).single()}updateProfile(t){var a;const s=Object.assign(Object.assign({},t),{id:null===(a=this.user)||void 0===a?void 0:a.id,updated_at:new Date});return this.supabaseClient.from("profiles").upsert(s,{returning:"minimal"})}downLoadImage(t){return this.supabaseClient.storage.from("avatars").download(t)}uploadAvatar(t,a){return this.supabaseClient.storage.from("avatars").upload(t,a)}signUp(t,a){return this.supabaseClient.auth.signUp({email:t,password:a})}signIn(t,a){return this.supabaseClient.auth.signIn({email:t,password:a})}signInWithProvider(t){return this.supabaseClient.auth.signIn({provider:t},{redirectTo:"http://localhost:4200/"})}signInWithProviderObs(t){return(0,S.D)(this.supabaseClient.auth.signIn({provider:t}))}signOut(){return this.supabaseClient.auth.signOut()}resetPassword(t){return this.supabaseClient.auth.api.resetPasswordForEmail(t)}handleNewPassword(t){return this.supabaseClient.auth.api.updateUser(this.token,{password:t})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var U=r(6204),j=r(2542),T=r(1120),p=r(7489),_=r(4297),M=r(2313),N=r(4687);let O=(()=>{class i{constructor(t,a){this.accountSvc=t,this.dom=a,this._avatarUrl="assets/custom/images/user_default.png",this.uploading=!1,this.inlineUserMenuActive=!1,this.upload=new e.vpe}set avatarUrl(t){t&&this.downloadImage(t)}downloadImage(t){return(0,c.mG)(this,void 0,void 0,function*(){try{const a=yield this.accountSvc.downLoadImage(t);this._avatarUrl=null!==a?this.dom.bypassSecurityTrustResourceUrl(URL.createObjectURL(null==a?void 0:a.data)):"assets/custom/images/user_default.png"}catch(a){console.error("Error downloading image: ",a.message)}})}uploadAvatar(t){return(0,c.mG)(this,void 0,void 0,function*(){let a="";try{if(this.uploading=!0,!t.target.files||0===t.target.files.length)throw new Error("You must select an image to upload.");const s=t.target.files[0],u=s.name.split(".").pop();a=`${Math.random()}.${u}`,yield this.accountSvc.uploadAvatar(a,s),this.upload.emit(a)}catch(s){alert(s.message)}finally{this.uploading=!1,this.avatarUrl=a}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d),e.Y36(M.H7))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-avatar"]],inputs:{avatarUrl:"avatarUrl"},outputs:{upload:"upload"},decls:9,vars:2,consts:[[1,"layout-profile","avatarCustomStyle"],["href","javascript:fileAvatar.click()",1,"layout-profile-button",3,"click"],[3,"click"],["alt","user_avatar",1,"avatarCustomStyle",3,"src"],[1,"layout-profile-userinfo",2,"margin-top","-22px"],[1,"layout-profile-name"],["type","file","id","single","accept","image/*",2,"visibility","hidden",3,"change"],["fileAvatar",""]],template:function(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"div",0)(1,"a",1),e.NdJ("click",function(){return a.inlineUserMenuActive=!a.inlineUserMenuActive}),e.TgZ(2,"div",2),e.NdJ("click",function(){return e.CHM(s),e.MAs(8).click()}),e._UZ(3,"img",3),e.qZA(),e.TgZ(4,"div",4)(5,"p",5),e._uU(6),e.qZA(),e.TgZ(7,"input",6,7),e.NdJ("change",function(m){return a.uploadAvatar(m)}),e.qZA()()()()}2&t&&(e.xp6(3),e.Q6J("src",a._avatarUrl,e.LSH),e.xp6(3),e.Oqu(a.uploading?"Uploading ...":""))},directives:[N.S],styles:[".avatarCustomStyle[_ngcontent-%COMP%]{text-align:center;border-radius:50%;cursor:pointer;height:150px}.avatar[_ngcontent-%COMP%]{border-radius:var(--custom-border-radius);overflow:hidden;max-width:100%}.avatar.image[_ngcontent-%COMP%]{-o-object-fit:cover;object-fit:cover}.avatar.no-image[_ngcontent-%COMP%]{background-color:#333;border:1px solid #c8c8c8;border-radius:5px}"]}),i})();var v=r(7038),w=r(9783),I=r(845);function P(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSubmit()}),e.qZA(),e.TgZ(1,"button",14),e.NdJ("click",function(){return!1}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.objCfg.form.valid)}}const Z=function(){return{"margin-bottom":"2em",width:"100%"}};let E=(()=>{class i extends T.Z{constructor(t,a,s){super(),this.accountSvc=t,this.toastService=a,this.authService=s,this.urlResource="user/config",this.loading=!1,this.objCfg={fields:new Array,form:new o.cw({}),model:{id:0,firstName:"",lastName:"",username:"",website:""}},this.objAccount={profile:null,session:null}}ngOnInit(){this.objCfg.fields=[...A],this.getProfile(),this.subSink.sink=this.authService.stateWithPropertyChanges.subscribe(t=>{t&&t.stateChanges.hasOwnProperty("authStateChanges")&&(this.objAccount.session=(0,p.get)(t.stateChanges.authStateChanges,["session"],null))})}updateProfile(t=""){return(0,c.mG)(this,void 0,void 0,function*(){try{this.loading=!0;const a=Object.assign(Object.assign({},(0,p.omit)(this.objCfg.model,["email"])),{avatar_url:t});yield this.accountSvc.updateProfile(a)}catch(a){this.informUserError(a.message)}finally{this.loading=!1}})}getProfile(){return(0,c.mG)(this,void 0,void 0,function*(){this.loading=!0;let{data:t,error:a,status:s}=yield this.accountSvc.profile;console.log("profile ***",t,a,s,(0,p.get)(this.authService.user,["email"],null),this.objAccount.session),t&&!a?(this.objCfg.model={id:0,firstName:null==t?void 0:t.firstName,lastName:null==t?void 0:t.lastName,username:null==t?void 0:t.username,email:(0,p.get)(this.authService.user,["email"],null),website:null==t?void 0:t.website},this.objAccount.profile=t):this.informUserError(a.message)})}resetForm(){this.objCfg.form.reset()}onSubmit(){var t;this.objCfg.form.valid&&this.updateProfile(null===(t=this.objAccount.profile)||void 0===t?void 0:t.avatar_url)}informUserError(t){this.loading=!1,this.toastService.add("warn","Service Message",t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d),e.Y36(U.o),e.Y36(j.e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-config"]],features:[e.qOj],decls:14,vars:10,consts:[[3,"header"],[1,"cstm-card"],[1,"p-grid",2,"margin-top","-20px"],[2,"width","100%"],[1,"p-grid"],[1,"p-col-12","p-md-3"],[3,"avatarUrl","upload"],[2,"text-align","center"],[1,"layout-profile-name"],[1,"p-col-12","p-md-9"],[3,"formGroup"],[3,"form","model","fields"],["pTemplate","footer"],["pButton","","pRipple","","label","Guardar","icon","pi pi-check","type","submit",1,"p-button-text","p-button-rounded","p-button-raised",3,"disabled","click"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times","type","reset",1,"p-button-text","p-button-rounded","p-button-raised","p-ml-2",3,"click"]],template:function(t,a){1&t&&(e.TgZ(0,"p-card",0)(1,"div",1)(2,"div",2)(3,"p-card",3)(4,"div",4)(5,"div",5)(6,"app-avatar",6),e.NdJ("upload",function(u){return a.updateProfile(u)}),e.qZA(),e.TgZ(7,"div",7)(8,"p",8),e._uU(9),e.qZA()()(),e.TgZ(10,"div",9)(11,"form",10),e._UZ(12,"formly-form",11),e.qZA()()(),e.YNc(13,P,2,1,"ng-template",12),e.qZA()()()()),2&t&&(e.Akn(e.DdM(9,Z)),e.s9C("header",a.componentTitle),e.xp6(6),e.Q6J("avatarUrl",null==a.objAccount.profile?null:a.objAccount.profile.avatar_url),e.xp6(3),e.Oqu(a.objCfg.model.username),e.xp6(2),e.Q6J("formGroup",a.objCfg.form),e.xp6(1),e.Q6J("form",a.objCfg.form)("model",a.objCfg.model)("fields",a.objCfg.fields))},directives:[_.Z,O,o._Y,o.JL,o.sg,v.T7,w.jx,I.Hq],styles:["[_nghost-%COMP%]     .p-card .p-card-footer{text-align:-webkit-right}[_nghost-%COMP%]     .avatar{border-radius:var(--custom-border-radius);overflow:hidden;max-width:100%}[_nghost-%COMP%]     .avatar.image{-o-object-fit:cover;object-fit:cover}[_nghost-%COMP%]     .avatar.no-image{background-color:#333;border:1px solid #c8c8c8;border-radius:5px}"]}),i})();var h=r(9808),J=r(7113);let k=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[h.ez]]}),i})(),D=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[d],imports:[[b.Bz.forChild([{path:"",component:E}]),C.h,h.ez,o.u5,o.UX,J.x,v.X0,k]]}),i})()}}]);